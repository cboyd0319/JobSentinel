# v2.6.3 - Security & Stability

**Release Date:** January 25, 2026

## Overview

Security hardening, memory leak fixes, and enhanced error handling. This release adds custom
React hooks for common patterns, standardizes error handling across the codebase, and improves
form validation.

## Custom React Hooks

### useOptimisticUpdate

Optimistic UI updates with automatic rollback on failure.

```typescript
const { update, isUpdating } = useOptimisticUpdate({
  updateFn: async (data) => await invoke("save_settings", { data }),
  onSuccess: () => showToast("Saved successfully"),
  onError: (error) => showToast(`Failed: ${error.message}`)
});

// Updates UI immediately, rolls back if save fails
await update(newSettings);
```

**Features:**

- Immediate UI updates for responsive UX
- Automatic rollback on failure
- Success/error callbacks
- Toast notification integration

### usePagination

Client-side pagination with navigation.

```typescript
const { currentPage, totalPages, paginatedData, nextPage, prevPage, goToPage, resetPage } =
  usePagination(items, { pageSize: 20 });
```

**Features:**

- Page state management
- Next/prev/goToPage navigation
- Configurable page size
- Auto-calculation of total pages
- Reset functionality for filter changes

### useFormValidation

Form validation with touched state tracking.

```typescript
const { values, errors, touched, setFieldValue, validateField, validateAll, resetForm } =
  useFormValidation({
    initialValues: { email: "", phone: "" },
    validators: {
      email: validateRequiredEmail,
      phone: validatePhone
    }
  });
```

**Features:**

- Per-field validation with custom validators
- Touched state tracking for progressive validation
- Batch validation with validateAll() for submission
- Reset functionality

## Error Handling Improvements

### errorHelpers.ts

Centralized error handling utilities.

**Error Classification:**

```typescript
classifyError(error) // Returns: "network" | "api" | "validation" | "timeout" | "unknown"
```

**User-Friendly Messages:**

```typescript
getUserFriendlyMessage(error) // Converts technical errors to readable messages
```

**Retry Logic:**

```typescript
shouldRetry(error) // Determines if error is retryable
withRetry(fn, { maxAttempts: 3, backoffMs: 1000 }) // Exponential backoff retry
```

**Debounced Error Handlers:**

```typescript
createDebouncedErrorHandler(handler, 500) // Prevents error spam
```

### Enhanced Error Boundaries

**ComponentErrorBoundary** - Component-level error isolation.

```typescript
<ComponentErrorBoundary
  fallback={(error, retry) => (
    <ErrorFallback error={error} onRetry={retry} />
  )}
>
  <SomeComponent />
</ComponentErrorBoundary>
```

**Features:**

- Isolates failures to individual components
- Retry functionality without full page reload
- Custom fallback UI
- Error reporting integration

## Form Validation Utilities

### formValidation.ts

Shared validation functions for consistent form behavior.

**Validators:**

- `validateRequiredEmail(value)` - Required email with format check
- `validateOptionalEmail(value)` - Optional email, validates if provided
- `validateUrl(value)` - URL with protocol enforcement
- `validatePhone(value)` - Phone number (10-15 digits)
- `validatePattern(value, pattern)` - Regex pattern validation
- `validateSlackWebhook(url)` - Slack webhook URL format
- `validateDiscordWebhook(url)` - Discord webhook URL format
- `validateEmailList(value)` - Comma-separated email validation

**Usage:**

```typescript
import { validateRequiredEmail, validateUrl } from "@/utils/formValidation";

const errors = {
  email: validateRequiredEmail(formData.email),
  website: validateUrl(formData.website)
};
```

## Security Fixes

### XSS Prevention

- HTML sanitization for user-generated content
- Safe rendering of job descriptions
- Escaped output in templates

### URL Validation

- Protocol enforcement (https:// required)
- Webhook URL format validation
- Deep link validation

### Input Sanitization

- Email list parsing with trim
- Phone number normalization
- Regex pattern validation

## Memory Leak Fixes

### useEffect Cleanup

Added cleanup functions to 20+ components:

```typescript
useEffect(() => {
  const subscription = someObservable.subscribe();
  return () => subscription.unsubscribe(); // Cleanup
}, []);
```

### Subscription Management

- WebSocket cleanup in real-time features
- Event listener removal
- Timer/interval cleanup
- AbortController for fetch requests

## Config Validation

### Runtime Validation

Comprehensive config validation at startup:

```typescript
validateConfig(config) // Validates all settings before use
```

**Validation Rules:**

- Email format (SMTP settings)
- Webhook URL format (Slack, Discord, Teams)
- Numeric ranges (port numbers, limits)
- Required fields
- Mutually exclusive options

### Error Messages

User-friendly validation errors:

```text
Invalid SMTP port: must be between 1 and 65535
Invalid Slack webhook: must start with https://hooks.slack.com/
Configuration validated successfully
```

## Test Coverage

### New Tests (145+ total)

**ApplyButton Tests (44 tests):**

- Rendering with different states
- Modal open/close behavior
- Form field rendering
- Error handling
- Success/failure scenarios
- Loading states
- Accessibility (ARIA labels, keyboard nav)

**Custom Hook Tests (60+ tests):**

- useOptimisticUpdate: success, failure, rollback
- usePagination: navigation, edge cases
- useFormValidation: per-field validation, touched state, batch validation

**Utility Tests (41+ tests):**

- formValidation: all validators, edge cases
- errorHelpers: classification, retry logic, user messages

## Technical Details

### Files Added

**Hooks:**

- `src/hooks/useOptimisticUpdate.ts`
- `src/hooks/usePagination.ts`
- `src/hooks/useFormValidation.ts`

**Utilities:**

- `src/utils/errorHelpers.ts`
- `src/utils/formValidation.ts`

**Components:**

- `src/components/ComponentErrorBoundary.tsx`

**Tests:**

- `tests/components/automation/ApplyButton.test.tsx`
- `tests/hooks/useOptimisticUpdate.test.ts`
- `tests/hooks/usePagination.test.ts`
- `tests/hooks/useFormValidation.test.ts`
- `tests/utils/formValidation.test.ts`

### Files Modified

**Security Improvements:**

- `src/components/JobCard.tsx` - HTML sanitization
- `src/components/automation/ProfileForm.tsx` - Input validation
- `src/pages/Settings.tsx` - Config validation

**Memory Leak Fixes:**

- `src/pages/Dashboard.tsx` - useEffect cleanup
- `src/components/automation/ApplyButton.tsx` - Subscription cleanup
- 15+ additional component files

### Build Status

- **4,565+ tests passing** (2,390 Frontend + 2,175 Rust)
- TypeScript: 0 errors
- ESLint: 0 errors (1 intentional disable)
- Rust: cargo clippy passes with -D warnings
- All integration tests passing

## Migration Notes

No breaking changes. All additions are backward compatible.

**Recommended Actions:**

1. Replace inline validation with `formValidation.ts` utilities
2. Wrap unreliable components in `ComponentErrorBoundary`
3. Use `useOptimisticUpdate` for save operations
4. Use `usePagination` for large lists
5. Use `useFormValidation` for forms with multiple fields

## What's Next (v2.7)

- Machine learning predictions for job matching
- Linux support (AppImage, .deb, .rpm installers)
- Intel Mac support (universal binary)
- Undo/Redo wiring for Dashboard actions
- Auto-detect location (IP geolocation)

See [ROADMAP.md](../ROADMAP.md) for full roadmap.
